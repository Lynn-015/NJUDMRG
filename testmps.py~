import numpy as np
from scipy.linalg import kron

from mps import MPS,ket2mps,overlap,expect

class TestMPS(object):
	def __init__(self):
		self.ket=np.random.rand(2**6)
		self.ket2=np.random.rand(2**6)
		self.mps=ket2mps(self.ket,2,6,cano='right')
		self.mps2=ket2mps(self.ket2,2,6,cano='right')
		self.ops=[np.random.random(size=(2,2)) for i in range(6)]

	def check_shape(self):
		for M in self.mps.Ms:
			print M.shape  

	def check_cano(self):
		self.mps.check_cano(cano='mixed',div=3)

	def test_toket(self):
		tket=self.mps.toket()
		print tket-self.ket

	def test_ovlap(self):
		ovlap=overlap(self.mps,self.mps2)
		print ovlap
		ov=self.ket.conjugate().transpose().dot(self.ket2)
		print ov
	
	def test_expect(self):
		exp=expect(self.mps,self.ops)
		OP=self.ops[0]
		for i in range(1,6):
			OP=kron(OP,self.ops[i])
		exp2=self.ket.conjugate().transpose().dot(OP.dot(self.ket))
		print exp
		print exp2
		

if __name__=='__main__':
	testmps=TestMPS()
	#testmps.check_shape()
	#testmps.check_cano()
	#testmps.test_toket()
	#testmps.test_ovlap()
	testmps.test_expect()
